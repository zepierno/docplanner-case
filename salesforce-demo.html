<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Demo - Docplanner Expansion Pipeline</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .sf-blue { background-color: #0176d3; }
        .sf-blue-dark { background-color: #014486; }
        .sf-blue-text { color: #0176d3; }
        .dp-teal { background-color: #00b39b; }
        .dp-teal-text { color: #00b39b; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes typing { from { width: 0; } to { width: 100%; } }
        @keyframes blink { 50% { border-color: transparent; } }
        .animate-pulse { animation: pulse 1.5s ease-in-out infinite; }
        .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .debug-panel { font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; }
        .typing-effect { overflow: hidden; white-space: nowrap; border-right: 2px solid #00b39b; animation: typing 2s steps(40, end), blink 0.75s step-end infinite; }
        .json-key { color: #7dd3fc; }
        .json-string { color: #86efac; }
        .json-number { color: #fbbf24; }
        .json-boolean { color: #c084fc; }
        .chat-bubble-user { background: linear-gradient(135deg, #00b39b 0%, #009681 100%); }
        .chat-bubble-bot { background: #f1f5f9; }
        .processing-dot { animation: pulse 1s ease-in-out infinite; }
        .processing-dot:nth-child(2) { animation-delay: 0.2s; }
        .processing-dot:nth-child(3) { animation-delay: 0.4s; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==================== SCENARIO CONFIGURATIONS ====================
        const scenarios = {
            small_clinic: {
                keywords: ['video', 'videollamada', 'llamada', 'telemedicina', 'boton', 'button', 'paciente', 'remoto', 'consulta online'],
                customerName: 'Dr. Carlos Mendoza',
                clinicName: 'Cl√≠nica Dental Sonrisa',
                practitioners: 2,
                currentPlan: 'Basic',
                caseId: 'CS-12853',
                classification: {
                    intent: 'expansion',
                    confidence: 0.94,
                    product_interest: 'video_calls',
                    sentiment: 'positive',
                    triggers: {
                        not_on_premium: true,
                        onboarding_completed: true,
                        no_active_incidents: true,
                        high_engagement: true,
                        good_standing: true,
                        feature_discovery_attempts: true,
                        positive_sentiment: true,
                        usage_velocity_positive: false,
                        multi_user_growth: false,
                        contract_renewal_soon: false
                    },
                    triggers_met: 7,
                    triggers_total: 10,
                    recommended_action: 'auto_softsell',
                    routing: {
                        team: 'expansion_auto',
                        priority: 'high',
                        sla_hours: 2
                    },
                    reasoning: 'Customer on Basic plan actively seeking video call feature. Positive sentiment, high engagement. Small clinic (2 practitioners) - suitable for automated soft-sell flow.'
                },
                autoReply: `Dear Dr. Mendoza,

Thank you for reaching out! I completely understand ‚Äî video consultations have become essential for many clinics, especially when patients prefer the convenience of remote appointments.

I wanted to clarify that video consultation is a feature included in our Premium Suite, which is why you're not seeing the button in your current dashboard. This isn't a bug ‚Äî it's simply a capability we haven't unlocked for your plan yet.

The Premium Suite includes everything you need for telemedicine:
‚úì HD Video Calls directly in the patient profile
‚úì Screen sharing for test results and images
‚úì Automatic appointment reminders for video sessions
‚úì Recording capabilities (with patient consent)

Would you like me to send you more details about the Premium Suite? You can also start a 14-day free trial directly from your dashboard to see if it fits your clinic's needs ‚Äî no commitment required.

Best regards,
Docplanner Support Team`,
                nextStep: 'Auto Soft-Sell Sent',
                leadValue: '‚Ç¨2,400/yr'
            },
            enterprise: {
                keywords: ['hospital', 'enterprise', '127', 'practitioners', 'departamentos', 'departments', 'integracion', 'integration', 'multiple', 'varios'],
                customerName: 'Dr. Elena Ruiz',
                clinicName: 'Hospital Universitario Madrid',
                practitioners: 127,
                currentPlan: 'Basic',
                caseId: 'CS-12854',
                classification: {
                    intent: 'expansion',
                    confidence: 0.97,
                    product_interest: 'premium_suite',
                    sentiment: 'positive',
                    triggers: {
                        not_on_premium: true,
                        onboarding_completed: true,
                        no_active_incidents: true,
                        high_engagement: true,
                        good_standing: true,
                        feature_discovery_attempts: true,
                        positive_sentiment: true,
                        usage_velocity_positive: true,
                        multi_user_growth: true,
                        contract_renewal_soon: false
                    },
                    triggers_met: 9,
                    triggers_total: 10,
                    recommended_action: 'sales_handoff',
                    routing: {
                        team: 'enterprise_sales',
                        priority: 'high',
                        sla_hours: 2
                    },
                    reasoning: 'Enterprise hospital (127 practitioners) explicitly requesting telemedicine solution. High-value opportunity requiring consultative sales approach. Create Lead and assign to Enterprise Sales immediately.'
                },
                autoReply: `Dear Dr. Ruiz,

Thank you for contacting us. Implementing telemedicine across a large hospital like Hospital Universitario Madrid is an exciting initiative, and I'm glad you're considering Docplanner for this.

Given the scale of your needs ‚Äî 127 practitioners across multiple departments ‚Äî this is exactly the kind of project our Enterprise Solutions team specializes in.

I've connected you with Mar√≠a Gonz√°lez, our Enterprise Account Executive, who will reach out within the next 2 hours to discuss:
‚Ä¢ Custom telemedicine implementation for your hospital's workflow
‚Ä¢ Integration options with your existing systems
‚Ä¢ Volume-based pricing designed for institutions your size
‚Ä¢ Dedicated onboarding and ongoing support

Mar√≠a has extensive experience with healthcare institutions and will be your dedicated point of contact throughout this process. In the meantime, I'm happy to answer any immediate questions you might have.

Best regards,
Docplanner Support Team`,
                nextStep: 'Assigned to Sales',
                leadValue: '‚Ç¨48,000/yr'
            },
            training: {
                keywords: ['exportar', 'export patient', 'export list', 'excel', 'descargar lista', 'download list', 'como exporto', 'how do i export', 'accountant', 'contador'],
                customerName: 'Dr. Pablo Torres',
                clinicName: 'Centro M√©dico Valencia',
                practitioners: 3,
                currentPlan: 'Premium',
                caseId: 'CS-12855',
                classification: {
                    intent: 'training',
                    confidence: 0.91,
                    product_interest: null,
                    sentiment: 'neutral',
                    triggers: {
                        not_on_premium: false,
                        onboarding_completed: true,
                        no_active_incidents: true,
                        high_engagement: true,
                        good_standing: true,
                        feature_discovery_attempts: false,
                        positive_sentiment: false,
                        usage_velocity_positive: false,
                        multi_user_growth: false,
                        contract_renewal_soon: false
                    },
                    triggers_met: 0,
                    triggers_total: 10,
                    recommended_action: 'send_tutorial',
                    routing: {
                        team: 'support_l1',
                        priority: 'medium',
                        sla_hours: 24
                    },
                    reasoning: 'Customer asking how to use existing feature (export). Already on Premium plan. Send tutorial link for patient export functionality.'
                },
                autoReply: `Dear Dr. Torres,

Thank you for your question! Exporting your patient list is easy:

1. Go to "Patients" in the main menu
2. Click the "Export" button (top right)
3. Select the format (Excel, CSV, or PDF)
4. Choose which fields to include
5. Click "Download"

Here's a quick video tutorial that walks you through the process:
üìπ https://help.docplanner.com/export-patients

If you need any further assistance, feel free to reach out!

Best regards,
Docplanner Support Team`,
                nextStep: 'Tutorial Sent',
                leadValue: null
            }
        };

        // ==================== INITIAL MOCK DATA ====================
        const initialCases = [
            { id: 'CS-12847', subject: "Can't find video call button", clinic: 'Cl√≠nica Salud Plus', type: 'expansion', size: 'small', status: 'Resolved', created: '1 hour ago', priority: 'High', nextStep: 'Auto Soft-Sell Sent' },
            { id: 'CS-12848', subject: 'Telemedicine for 50 practitioners', clinic: 'Centro M√©dico Regional', type: 'expansion', size: 'enterprise', status: 'Resolved', created: '2 hours ago', priority: 'High', nextStep: 'Assigned to Sales' },
            { id: 'CS-12849', subject: 'How to export patient list?', clinic: 'Fisioterapia Barcelona', type: 'training', size: 'small', status: 'Resolved', created: '3 hours ago', priority: 'Medium', nextStep: 'Tutorial Sent' },
            { id: 'CS-12850', subject: 'Calendar sync error with Google', clinic: 'Dental Care Madrid', type: 'bug', size: 'small', status: 'Open', created: '4 hours ago', priority: 'High', nextStep: 'Escalate to Tech' },
            { id: 'CS-12851', subject: 'Need help setting up appointments', clinic: 'Cl√≠nica Oftalmol√≥gica Sur', type: 'reonboarding', size: 'small', status: 'Open', created: '5 hours ago', priority: 'Medium', nextStep: 'Schedule Re-onboarding' },
        ];

        const initialLeads = [
            { id: 'LD-5520', clinic: 'Centro M√©dico Regional', contact: 'Dr. Ana Garc√≠a', email: 'ana.garcia@cmr.es', value: '‚Ç¨24,000/yr', status: 'Qualified', source: 'Support Expansion Signal', assigned: 'Mar√≠a Gonz√°lez', created: '2 hours ago', converted: false },
            { id: 'LD-5519', clinic: 'Cl√≠nica Salud Plus', contact: 'Dr. Miguel Santos', email: 'miguel.santos@saludplus.es', value: '‚Ç¨2,400/yr', status: 'New', source: 'Support Expansion Signal', assigned: 'Auto-assigned', created: '1 hour ago', converted: false },
        ];

        const initialOpportunities = [
            { id: 'OPP-2847', clinic: 'Red Salud Valencia', contact: 'Dra. Ana Moreno', value: '‚Ç¨24,000/yr', stage: 'Negotiation', probability: '85%', closeDate: 'Feb 10, 2026', source: 'Support Signal', owner: 'Mar√≠a Gonz√°lez', leadId: 'LD-5498', caseId: 'CS-12756' },
            { id: 'OPP-2839', clinic: 'Cl√≠nica Premium Barcelona', contact: 'Dr. Mart√≠n √Ålvarez', value: '‚Ç¨12,000/yr', stage: 'Proposal', probability: '60%', closeDate: 'Feb 28, 2026', source: 'Support Signal', owner: 'Carlos Ruiz', leadId: 'LD-5512', caseId: 'CS-12801' },
        ];

        // ==================== HELPER FUNCTIONS ====================
        const getTypeConfig = (type) => {
            const configs = {
                expansion: { label: 'Expansion Opportunity', color: 'bg-emerald-500', icon: 'üéØ', textColor: 'text-emerald-700', bgLight: 'bg-emerald-50', borderColor: 'border-emerald-500' },
                training: { label: 'Training Issue', color: 'bg-blue-500', icon: 'üìö', textColor: 'text-blue-700', bgLight: 'bg-blue-50', borderColor: 'border-blue-500' },
                bug: { label: 'Bug / Technical', color: 'bg-red-500', icon: 'üêõ', textColor: 'text-red-700', bgLight: 'bg-red-50', borderColor: 'border-red-500' },
                reonboarding: { label: 'Re-onboarding Needed', color: 'bg-amber-500', icon: 'üîÑ', textColor: 'text-amber-700', bgLight: 'bg-amber-50', borderColor: 'border-amber-500' },
                general: { label: 'General Inquiry', color: 'bg-slate-500', icon: 'üí¨', textColor: 'text-slate-700', bgLight: 'bg-slate-50', borderColor: 'border-slate-500' },
            };
            return configs[type] || configs.general;
        };

        const detectScenario = (message) => {
            const lowerMessage = message.toLowerCase();
            
            // Check enterprise first (most specific - large numbers, hospital, departments)
            if (scenarios.enterprise.keywords.some(kw => lowerMessage.includes(kw))) {
                return 'enterprise';
            }
            // Check small clinic second (video calls, telemedicine requests)
            if (scenarios.small_clinic.keywords.some(kw => lowerMessage.includes(kw))) {
                return 'small_clinic';
            }
            // Check training last (how-to questions, export, etc.)
            if (scenarios.training.keywords.some(kw => lowerMessage.includes(kw))) {
                return 'training';
            }
            // Fallback to small clinic
            return 'small_clinic';
        };

        // ==================== CHAT COMPONENT ====================
        const ChatInterface = ({ onSubmit, isProcessing }) => {
            const [message, setMessage] = useState('');
            const [chatHistory, setChatHistory] = useState([
                { type: 'system', text: 'Welcome to Docplanner Support. How can I help you today?' }
            ]);

            const handleSubmit = () => {
                if (!message.trim() || isProcessing) return;
                
                setChatHistory(prev => [...prev, { type: 'user', text: message }]);
                onSubmit(message);
                setMessage('');
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSubmit();
                }
            };

            const exampleMessages = [
                { label: 'üè™ Small Clinic', text: "Hello, I'm trying to do a video call with a patient but I can't find the button anywhere. Can you help me?" },
                { label: 'üè¢ Enterprise', text: "We need telemedicine capabilities for our hospital. We have 127 practitioners across multiple departments and need integration with our systems." },
                { label: 'üìö Training', text: "How do I export my patient list to Excel? I need to send it to my accountant." }
            ];

            return (
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden max-w-lg mx-auto">
                    {/* Chat Header */}
                    <div className="dp-teal text-white px-6 py-4">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                <span className="text-xl">üí¨</span>
                            </div>
                            <div>
                                <h3 className="font-semibold">Docplanner Support</h3>
                                <p className="text-sm text-white/80">We typically reply within minutes</p>
                            </div>
                        </div>
                    </div>

                    {/* Chat Messages */}
                    <div className="h-64 overflow-y-auto p-4 space-y-3 bg-gray-50">
                        {chatHistory.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] px-4 py-2 rounded-2xl ${
                                    msg.type === 'user' 
                                        ? 'chat-bubble-user text-white rounded-br-md' 
                                        : msg.type === 'system'
                                        ? 'chat-bubble-bot text-gray-700 rounded-bl-md'
                                        : 'chat-bubble-bot text-gray-700 rounded-bl-md'
                                }`}>
                                    <p className="text-sm">{msg.text}</p>
                                </div>
                            </div>
                        ))}
                        {isProcessing && (
                            <div className="flex justify-start">
                                <div className="chat-bubble-bot px-4 py-3 rounded-2xl rounded-bl-md">
                                    <div className="flex gap-1">
                                        <div className="w-2 h-2 bg-gray-400 rounded-full processing-dot"></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full processing-dot"></div>
                                        <div className="w-2 h-2 bg-gray-400 rounded-full processing-dot"></div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Example Buttons */}
                    <div className="px-4 py-2 border-t border-gray-100 bg-white">
                        <p className="text-xs text-gray-500 mb-2">Try an example:</p>
                        <div className="flex flex-wrap gap-2">
                            {exampleMessages.map((ex, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => setMessage(ex.text)}
                                    disabled={isProcessing}
                                    className="text-xs px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700 transition-colors disabled:opacity-50"
                                >
                                    {ex.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Input */}
                    <div className="p-4 border-t border-gray-200 bg-white">
                        <div className="flex gap-2">
                            <textarea
                                value={message}
                                onChange={(e) => setMessage(e.target.value)}
                                onKeyPress={handleKeyPress}
                                placeholder="Type your message..."
                                disabled={isProcessing}
                                className="flex-1 px-4 py-2 border border-gray-300 rounded-xl text-sm resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent disabled:bg-gray-100"
                                rows={2}
                            />
                            <button
                                onClick={handleSubmit}
                                disabled={!message.trim() || isProcessing}
                                className="px-4 py-2 dp-teal text-white rounded-xl font-medium hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== AI PROCESSING COMPONENT ====================
        const AIProcessing = ({ stage, scenario }) => {
            const stages = [
                { key: 'receiving', label: 'Receiving message...', icon: 'üì®' },
                { key: 'analyzing', label: 'Analyzing content & context...', icon: 'üîç' },
                { key: 'classifying', label: 'Classifying intent...', icon: 'ü§ñ' },
                { key: 'evaluating', label: 'Evaluating expansion triggers...', icon: 'üìä' },
                { key: 'generating', label: 'Generating response...', icon: '‚úçÔ∏è' },
                { key: 'routing', label: 'Determining routing...', icon: 'üéØ' },
                { key: 'complete', label: 'Classification complete!', icon: '‚úÖ' },
            ];

            const currentIndex = stages.findIndex(s => s.key === stage);

            return (
                <div className="bg-slate-900 rounded-2xl p-6 max-w-lg mx-auto shadow-xl">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                            <span className="text-xl">ü§ñ</span>
                        </div>
                        <div>
                            <h3 className="text-white font-semibold">AI Classification Engine</h3>
                            <p className="text-slate-400 text-sm">Processing support ticket...</p>
                        </div>
                    </div>

                    <div className="space-y-3">
                        {stages.map((s, idx) => (
                            <div 
                                key={s.key}
                                className={`flex items-center gap-3 px-4 py-2 rounded-lg transition-all duration-300 ${
                                    idx < currentIndex 
                                        ? 'bg-emerald-500/20 text-emerald-400' 
                                        : idx === currentIndex 
                                        ? 'bg-blue-500/20 text-blue-400 animate-pulse' 
                                        : 'bg-slate-800 text-slate-500'
                                }`}
                            >
                                <span>{idx < currentIndex ? '‚úì' : s.icon}</span>
                                <span className="text-sm">{s.label}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ==================== JSON OUTPUT COMPONENT ====================
        const JSONOutput = ({ classification, onContinue }) => {
            const [showFull, setShowFull] = useState(false);

            const formatJSON = (obj, indent = 0) => {
                const spaces = '  '.repeat(indent);
                let result = '';
                
                if (typeof obj === 'object' && obj !== null) {
                    const isArray = Array.isArray(obj);
                    result += isArray ? '[\n' : '{\n';
                    
                    const entries = Object.entries(obj);
                    entries.forEach(([key, value], idx) => {
                        const comma = idx < entries.length - 1 ? ',' : '';
                        if (isArray) {
                            result += `${spaces}  ${formatJSON(value, indent + 1)}${comma}\n`;
                        } else {
                            result += `${spaces}  <span class="json-key">"${key}"</span>: ${formatJSON(value, indent + 1)}${comma}\n`;
                        }
                    });
                    
                    result += spaces + (isArray ? ']' : '}');
                } else if (typeof obj === 'string') {
                    result = `<span class="json-string">"${obj}"</span>`;
                } else if (typeof obj === 'number') {
                    result = `<span class="json-number">${obj}</span>`;
                } else if (typeof obj === 'boolean') {
                    result = `<span class="json-boolean">${obj}</span>`;
                } else if (obj === null) {
                    result = `<span class="json-boolean">null</span>`;
                }
                
                return result;
            };

            // Simplified version for display
            const simplifiedClassification = {
                intent: classification.intent,
                confidence: classification.confidence,
                product_interest: classification.product_interest,
                sentiment: classification.sentiment,
                triggers_met: classification.triggers_met,
                triggers_total: classification.triggers_total,
                recommended_action: classification.recommended_action,
                routing: classification.routing,
                reasoning: classification.reasoning.substring(0, 80) + '...'
            };

            return (
                <div className="bg-slate-900 rounded-2xl p-6 max-w-2xl mx-auto shadow-xl animate-fade-in">
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                            <div className="flex gap-1.5">
                                <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                <div className="w-3 h-3 rounded-full bg-green-500"></div>
                            </div>
                            <span className="text-slate-400 text-sm">AI Classification Response</span>
                        </div>
                        <button
                            onClick={() => setShowFull(!showFull)}
                            className="text-xs text-slate-400 hover:text-white transition-colors"
                        >
                            {showFull ? 'Show Less' : 'Show Full JSON'}
                        </button>
                    </div>
                    
                    <pre 
                        className="text-sm overflow-x-auto text-slate-300 debug-panel"
                        dangerouslySetInnerHTML={{ 
                            __html: formatJSON(showFull ? classification : simplifiedClassification) 
                        }}
                    />

                    <div className="mt-6 flex justify-center">
                        <button
                            onClick={onContinue}
                            className="px-6 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-xl transition-colors flex items-center gap-2"
                        >
                            Continue to Salesforce
                            <span>‚Üí</span>
                        </button>
                    </div>
                </div>
            );
        };

        // ==================== SALESFORCE COMPONENTS ====================
        const SalesforceHeader = ({ currentView, setCurrentView, newCaseId }) => (
            <header className="sf-blue text-white shadow-lg">
                <div className="flex items-center justify-between px-4 py-3">
                    <div className="flex items-center gap-6">
                        <div className="flex items-center gap-3">
                            <div className="w-9 h-9 bg-white rounded flex items-center justify-center shadow">
                                <span className="sf-blue-text font-bold text-sm">SF</span>
                            </div>
                            <div>
                                <span className="font-semibold text-lg">Service Console</span>
                                <span className="text-blue-200 text-sm ml-2">| Docplanner</span>
                            </div>
                        </div>
                        <nav className="flex gap-1 ml-4">
                            {[
                                { key: 'cases', label: 'Cases' },
                                { key: 'leads', label: 'Leads' },
                                { key: 'opportunities', label: 'Opportunities' }
                            ].map((item) => (
                                <button 
                                    key={item.key}
                                    onClick={() => setCurrentView(item.key)}
                                    className={`px-5 py-2 rounded-t text-sm font-medium transition-all relative ${
                                        currentView === item.key || currentView.startsWith(item.key.slice(0, 4))
                                            ? 'bg-white text-blue-700 shadow' 
                                            : 'hover:bg-blue-600 text-blue-100'
                                    }`}
                                >
                                    {item.label}
                                    {item.key === 'cases' && newCaseId && (
                                        <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
                                    )}
                                </button>
                            ))}
                        </nav>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="relative">
                            <input 
                                type="text" 
                                placeholder="Search Salesforce..." 
                                className="w-72 px-4 py-2 rounded-lg bg-blue-600 text-white placeholder-blue-200 text-sm focus:outline-none focus:ring-2 focus:ring-white border border-blue-400"
                            />
                            <span className="absolute right-3 top-2.5 text-blue-200">üîç</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <button className="text-blue-200 hover:text-white relative">
                                üîî
                                {newCaseId && <span className="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span>}
                            </button>
                            <div className="w-9 h-9 bg-orange-400 rounded-full flex items-center justify-center text-sm font-semibold shadow">AG</div>
                        </div>
                    </div>
                </div>
            </header>
        );

        const CasesListView = ({ cases, onSelectCase, newCaseId, createdCaseIds }) => (
            <div className="p-6 animate-fade-in">
                <div className="flex items-center justify-between mb-6">
                    <h2 className="text-xl font-bold text-gray-800">Support Cases Queue</h2>
                    <div className="flex items-center gap-2 text-sm text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full">
                        <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                        AI Classification Active
                    </div>
                </div>

                <div className="bg-white rounded-xl shadow overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-gray-50 border-b">
                            <tr>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Case Number</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Subject</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Clinic</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">AI Classification</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Next Step</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            {cases.map((c) => {
                                const config = getTypeConfig(c.type);
                                const isNew = c.id === newCaseId;
                                const isClickable = createdCaseIds.includes(c.id);
                                return (
                                    <tr 
                                        key={c.id} 
                                        onClick={() => isClickable && onSelectCase(c)}
                                        className={`border-b transition-colors ${isNew ? 'bg-emerald-50 animate-fade-in' : ''} ${isClickable ? 'hover:bg-blue-50 cursor-pointer' : 'opacity-70'}`}
                                    >
                                        <td className="p-4">
                                            <div className="flex items-center gap-2">
                                                {isNew && <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>}
                                                <span className="sf-blue-text font-medium">{c.id}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-gray-700">{c.subject}</td>
                                        <td className="p-4 text-gray-600">{c.clinic}</td>
                                        <td className="p-4">
                                            <span className={`badge ${config.color} text-white`}>
                                                {config.icon} {config.label}
                                            </span>
                                        </td>
                                        <td className="p-4">
                                            <span className={`badge ${config.bgLight} ${config.textColor}`}>
                                                {c.nextStep}
                                            </span>
                                        </td>
                                        <td className="p-4 text-gray-500 text-sm">{c.created}</td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const CaseDetailView = ({ caseData, scenario, onBack, onViewLead }) => {
            const config = getTypeConfig(caseData.type);
            const scenarioData = scenarios[scenario];
            
            return (
                <div className="p-6 animate-fade-in">
                    <button onClick={onBack} className="flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4">
                        ‚Üê Back to Cases
                    </button>

                    <div className="grid grid-cols-3 gap-6">
                        {/* Main Content */}
                        <div className="col-span-2 space-y-6">
                            {/* AI Classification Banner */}
                            <div className={`${config.bgLight} border-l-4 ${config.borderColor} p-4 rounded-r-lg shadow-sm`}>
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl">{config.icon}</span>
                                        <div>
                                            <span className={`font-semibold ${config.textColor}`}>{config.label}</span>
                                            <span className="text-gray-500 text-sm ml-2">‚Ä¢ {(scenarioData.classification.confidence * 100).toFixed(0)}% confidence</span>
                                        </div>
                                    </div>
                                    {caseData.type === 'expansion' && (
                                        <span className={`badge ${caseData.size === 'enterprise' ? 'bg-purple-100 text-purple-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                            {caseData.size === 'enterprise' ? 'üè¢ Enterprise' : 'üè™ Small Clinic'}
                                        </span>
                                    )}
                                </div>
                            </div>

                            {/* Case Info Card */}
                            <div className="bg-white rounded-xl shadow p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">{caseData.subject}</h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <p className="text-sm text-gray-500">Case Number</p>
                                        <p className="font-medium">{caseData.id}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Status</p>
                                        <p className="font-medium">{caseData.status}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Priority</p>
                                        <p className="font-medium text-red-600">{caseData.priority}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Created</p>
                                        <p className="font-medium">{caseData.created}</p>
                                    </div>
                                </div>

                                <div className="border-t pt-4">
                                    <p className="text-sm text-gray-500 mb-2">Customer Message:</p>
                                    <div className="bg-gray-50 rounded-lg p-4 text-gray-700">
                                        {scenario === 'small_clinic' && "Hello, I'm trying to do a video call with a patient but I can't find the button anywhere. Can you help me?"}
                                        {scenario === 'enterprise' && "We need telemedicine capabilities for our hospital. We have 127 practitioners across multiple departments and need integration with our systems."}
                                        {scenario === 'training' && "How do I export my patient list to Excel? I need to send it to my accountant."}
                                    </div>
                                </div>
                            </div>

                            {/* Auto-Reply Preview */}
                            <div className="bg-white rounded-xl shadow p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="font-semibold text-gray-800">
                                        {caseData.type === 'expansion' && caseData.size === 'enterprise' ? 'üìß Notification Sent to Customer' : 'üìß Auto-Reply Sent'}
                                    </h3>
                                    <span className="badge bg-emerald-100 text-emerald-700">‚úì Sent</span>
                                </div>
                                <div className="bg-gray-50 rounded-lg p-4 text-sm text-gray-700 whitespace-pre-line max-h-64 overflow-y-auto">
                                    {scenarioData.autoReply}
                                </div>
                            </div>
                        </div>

                        {/* Sidebar */}
                        <div className="space-y-6">
                            {/* Account Info */}
                            <div className="bg-white rounded-xl shadow p-6">
                                <h3 className="font-semibold text-gray-800 mb-4">Account Information</h3>
                                <div className="space-y-3">
                                    <div>
                                        <p className="text-sm text-gray-500">Clinic</p>
                                        <p className="font-medium">{scenarioData.clinicName}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Contact</p>
                                        <p className="font-medium">{scenarioData.customerName}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Current Plan</p>
                                        <p className="font-medium">{scenarioData.currentPlan}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Practitioners</p>
                                        <p className="font-medium">{scenarioData.practitioners}</p>
                                    </div>
                                </div>
                            </div>

                            {/* Expansion Triggers */}
                            {caseData.type === 'expansion' && (
                                <div className="bg-white rounded-xl shadow p-6">
                                    <h3 className="font-semibold text-gray-800 mb-4">Expansion Triggers</h3>
                                    <div className="space-y-2">
                                        {Object.entries(scenarioData.classification.triggers).map(([key, value]) => (
                                            <div key={key} className="flex items-center justify-between text-sm">
                                                <span className="text-gray-600">{key.replace(/_/g, ' ')}</span>
                                                <span className={value ? 'text-emerald-600' : 'text-gray-400'}>{value ? '‚úì' : '‚úó'}</span>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="mt-4 pt-4 border-t">
                                        <div className="flex justify-between items-center">
                                            <span className="font-medium">Triggers Met</span>
                                            <span className="font-bold text-emerald-600">{scenarioData.classification.triggers_met}/{scenarioData.classification.triggers_total}</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Action Buttons */}
                            {caseData.type === 'expansion' && (
                                <div className="bg-white rounded-xl shadow p-6">
                                    <h3 className="font-semibold text-gray-800 mb-4">Actions</h3>
                                    <button 
                                        onClick={onViewLead}
                                        className="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
                                    >
                                        View Created Lead ‚Üí
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const LeadsListView = ({ leads, onSelectLead, newLeadId, createdLeadIds }) => (
            <div className="p-6 animate-fade-in">
                <div className="flex items-center justify-between mb-6">
                    <h2 className="text-xl font-bold text-gray-800">Expansion Leads</h2>
                    <span className="text-sm text-gray-500">{leads.length} leads from Support signals</span>
                </div>

                <div className="bg-white rounded-xl shadow overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-gray-50 border-b">
                            <tr>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Lead ID</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Clinic</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Contact</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Value</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Status</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            {leads.map((lead) => {
                                const isNew = lead.id === newLeadId;
                                const isClickable = createdLeadIds.includes(lead.id);
                                return (
                                    <tr 
                                        key={lead.id}
                                        onClick={() => isClickable && onSelectLead(lead)}
                                        className={`border-b transition-colors ${isNew ? 'bg-emerald-50 animate-fade-in' : ''} ${isClickable ? 'hover:bg-blue-50 cursor-pointer' : 'opacity-70'}`}
                                    >
                                        <td className="p-4">
                                            <div className="flex items-center gap-2">
                                                {isNew && <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>}
                                                <span className="sf-blue-text font-medium">{lead.id}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-gray-700">{lead.clinic}</td>
                                        <td className="p-4 text-gray-600">{lead.contact}</td>
                                        <td className="p-4 font-semibold text-emerald-600">{lead.value}</td>
                                        <td className="p-4">
                                            <span className={`badge ${lead.status === 'New' ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                                {lead.status}
                                            </span>
                                        </td>
                                        <td className="p-4 text-gray-500 text-sm">{lead.created}</td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const LeadDetailView = ({ lead, scenario, onBack, onConvert }) => {
            const scenarioData = scenario ? scenarios[scenario] : null;
            
            return (
                <div className="p-6 animate-fade-in">
                    <button onClick={onBack} className="flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4">
                        ‚Üê Back to Leads
                    </button>

                    <div className="grid grid-cols-3 gap-6">
                        <div className="col-span-2 space-y-6">
                            <div className="bg-white rounded-xl shadow p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold text-gray-800">{lead.clinic}</h2>
                                    <span className={`badge ${lead.status === 'New' ? 'bg-blue-100 text-blue-700' : 'bg-emerald-100 text-emerald-700'}`}>
                                        {lead.status}
                                    </span>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <p className="text-sm text-gray-500">Lead ID</p>
                                        <p className="font-medium">{lead.id}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Contact</p>
                                        <p className="font-medium">{lead.contact}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Email</p>
                                        <p className="font-medium text-blue-600">{lead.email}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Estimated Value</p>
                                        <p className="font-bold text-emerald-600 text-lg">{lead.value}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Source</p>
                                        <p className="font-medium">{lead.source}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Assigned To</p>
                                        <p className="font-medium">{lead.assigned}</p>
                                    </div>
                                </div>
                            </div>

                            {scenarioData && (
                                <div className="bg-white rounded-xl shadow p-6">
                                    <h3 className="font-semibold text-gray-800 mb-4">Original Support Request</h3>
                                    <div className="bg-gray-50 rounded-lg p-4 text-gray-700">
                                        {scenario === 'small_clinic' && "Hello, I'm trying to do a video call with a patient but I can't find the button anywhere. Can you help me?"}
                                        {scenario === 'enterprise' && "We need telemedicine capabilities for our hospital. We have 127 practitioners across multiple departments and need integration with our systems."}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="space-y-6">
                            <div className="bg-white rounded-xl shadow p-6">
                                <h3 className="font-semibold text-gray-800 mb-4">Actions</h3>
                                <div className="space-y-3">
                                    <button 
                                        onClick={onConvert}
                                        className="w-full py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors"
                                    >
                                        Convert to Opportunity
                                    </button>
                                    <button className="w-full py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
                                        Send Email
                                    </button>
                                    <button className="w-full py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
                                        Schedule Call
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const OpportunitiesListView = ({ opportunities }) => (
            <div className="p-6 animate-fade-in">
                <div className="flex items-center justify-between mb-6">
                    <h2 className="text-xl font-bold text-gray-800">Opportunities Pipeline</h2>
                    <span className="text-sm font-semibold text-emerald-600">
                        Total: ‚Ç¨{opportunities.reduce((sum, o) => sum + parseInt(o.value.replace(/[^0-9]/g, '')), 0).toLocaleString()}/yr
                    </span>
                </div>

                <div className="bg-white rounded-xl shadow overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-gray-50 border-b">
                            <tr>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Opportunity</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Clinic</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Value</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Stage</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Probability</th>
                                <th className="text-left p-4 font-semibold text-gray-600 text-sm">Close Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {opportunities.map((opp) => (
                                <tr key={opp.id} className="border-b hover:bg-blue-50 cursor-pointer transition-colors">
                                    <td className="p-4">
                                        <span className="sf-blue-text font-medium">{opp.id}</span>
                                    </td>
                                    <td className="p-4 text-gray-700">{opp.clinic}</td>
                                    <td className="p-4 font-semibold text-emerald-600">{opp.value}</td>
                                    <td className="p-4">
                                        <span className={`badge border ${
                                            opp.stage === 'Qualification' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                                            opp.stage === 'Proposal' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                                            'bg-emerald-50 text-emerald-700 border-emerald-200'
                                        }`}>
                                            {opp.stage}
                                        </span>
                                    </td>
                                    <td className="p-4 text-gray-600">{opp.probability}</td>
                                    <td className="p-4 text-gray-500 text-sm">{opp.closeDate}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // ==================== MAIN APP ====================
        const App = () => {
            // App state
            const [stage, setStage] = useState('chat'); // chat, processing, json, salesforce
            const [processingStage, setProcessingStage] = useState('receiving');
            const [currentScenario, setCurrentScenario] = useState(null);
            const [userMessage, setUserMessage] = useState('');
            
            // Salesforce state
            const [currentView, setCurrentView] = useState('cases');
            const [cases, setCases] = useState(initialCases);
            const [leads, setLeads] = useState(initialLeads);
            const [opportunities, setOpportunities] = useState(initialOpportunities);
            const [selectedCase, setSelectedCase] = useState(null);
            const [selectedLead, setSelectedLead] = useState(null);
            const [newCaseId, setNewCaseId] = useState(null);
            const [newLeadId, setNewLeadId] = useState(null);
            const [createdCaseIds, setCreatedCaseIds] = useState([]);
            const [createdLeadIds, setCreatedLeadIds] = useState([]);

            // Handle chat submission
            const handleChatSubmit = (message) => {
                setUserMessage(message);
                const scenario = detectScenario(message);
                setCurrentScenario(scenario);
                setStage('processing');

                // Simulate AI processing stages
                const stages = ['receiving', 'analyzing', 'classifying', 'evaluating', 'generating', 'routing', 'complete'];
                let stageIndex = 0;

                const interval = setInterval(() => {
                    stageIndex++;
                    if (stageIndex < stages.length) {
                        setProcessingStage(stages[stageIndex]);
                    } else {
                        clearInterval(interval);
                        setTimeout(() => setStage('json'), 500);
                    }
                }, 600);
            };

            // Handle continue to Salesforce
            const handleContinueToSalesforce = () => {
                const scenarioData = scenarios[currentScenario];
                
                // Create new case
                const newCase = {
                    id: scenarioData.caseId,
                    subject: currentScenario === 'small_clinic' 
                        ? "Can't find video call button" 
                        : currentScenario === 'enterprise'
                        ? 'Telemedicine for 127 practitioners'
                        : 'How to export patient list?',
                    clinic: scenarioData.clinicName,
                    type: scenarioData.classification.intent,
                    size: scenarioData.practitioners >= 20 ? 'enterprise' : 'small',
                    status: 'New',
                    created: 'Just now',
                    priority: 'High',
                    nextStep: scenarioData.nextStep
                };

                setCases(prev => [newCase, ...prev]);
                setNewCaseId(scenarioData.caseId);
                setCreatedCaseIds(prev => [...prev, scenarioData.caseId]);

                // Create lead if expansion
                if (scenarioData.classification.intent === 'expansion') {
                    const newLeadIdValue = `LD-${5521 + leads.length}`;
                    const newLead = {
                        id: newLeadIdValue,
                        clinic: scenarioData.clinicName,
                        contact: scenarioData.customerName,
                        email: scenarioData.customerName.toLowerCase().replace('dr. ', '').replace(' ', '.') + '@clinic.es',
                        value: scenarioData.leadValue,
                        status: 'New',
                        source: 'Support Expansion Signal',
                        assigned: currentScenario === 'enterprise' ? 'Mar√≠a Gonz√°lez' : 'Auto-assigned',
                        created: 'Just now',
                        converted: false
                    };
                    setLeads(prev => [newLead, ...prev]);
                    setNewLeadId(newLeadIdValue);
                    setCreatedLeadIds(prev => [...prev, newLeadIdValue]);
                }

                setStage('salesforce');
                setCurrentView('cases');
            };

            // Handle lead conversion
            const handleConvertLead = (lead) => {
                const newOpp = {
                    id: `OPP-${2848 + opportunities.length}`,
                    clinic: lead.clinic,
                    contact: lead.contact,
                    value: lead.value,
                    stage: 'Qualification',
                    probability: '50%',
                    closeDate: 'Mar 30, 2026',
                    source: 'Support Signal',
                    owner: lead.assigned,
                    leadId: lead.id
                };
                setOpportunities(prev => [newOpp, ...prev]);
                setLeads(prev => prev.map(l => l.id === lead.id ? {...l, status: 'Converted', converted: true} : l));
                setCurrentView('opportunities');
            };

            // Reset demo
            const handleReset = () => {
                setStage('chat');
                setProcessingStage('receiving');
                setCurrentScenario(null);
                setUserMessage('');
                setCases(initialCases);
                setLeads(initialLeads);
                setOpportunities(initialOpportunities);
                setSelectedCase(null);
                setSelectedLead(null);
                setNewCaseId(null);
                setNewLeadId(null);
                setCreatedCaseIds([]);
                setCreatedLeadIds([]);
                setCurrentView('cases');
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Demo Header */}
                    <div className="bg-slate-900 text-white px-6 py-3">
                        <div className="max-w-7xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <span className="text-xl font-bold">üöÄ Expansion Pipeline</span>
                                <span className="text-slate-400">|</span>
                                <span className="text-slate-300 text-sm">Interactive Demo</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-2 text-sm">
                                    <span className={`w-2 h-2 rounded-full ${stage === 'chat' ? 'bg-emerald-400' : 'bg-slate-600'}`}></span>
                                    <span className={stage === 'chat' ? 'text-white' : 'text-slate-500'}>Chat</span>
                                    <span className="text-slate-600">‚Üí</span>
                                    <span className={`w-2 h-2 rounded-full ${stage === 'processing' ? 'bg-emerald-400 animate-pulse' : stage === 'json' || stage === 'salesforce' ? 'bg-emerald-400' : 'bg-slate-600'}`}></span>
                                    <span className={stage === 'processing' ? 'text-white' : 'text-slate-500'}>AI</span>
                                    <span className="text-slate-600">‚Üí</span>
                                    <span className={`w-2 h-2 rounded-full ${stage === 'json' ? 'bg-emerald-400' : stage === 'salesforce' ? 'bg-emerald-400' : 'bg-slate-600'}`}></span>
                                    <span className={stage === 'json' ? 'text-white' : 'text-slate-500'}>JSON</span>
                                    <span className="text-slate-600">‚Üí</span>
                                    <span className={`w-2 h-2 rounded-full ${stage === 'salesforce' ? 'bg-emerald-400' : 'bg-slate-600'}`}></span>
                                    <span className={stage === 'salesforce' ? 'text-white' : 'text-slate-500'}>Salesforce</span>
                                </div>
                                {stage !== 'chat' && (
                                    <button
                                        onClick={handleReset}
                                        className="px-4 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors"
                                    >
                                        Reset Demo
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    {stage === 'chat' && (
                        <div className="max-w-7xl mx-auto py-12 px-6">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Start a Support Conversation</h1>
                                <p className="text-gray-600">Type a message or select an example to see the Expansion Pipeline in action</p>
                            </div>
                            <ChatInterface onSubmit={handleChatSubmit} isProcessing={false} />
                        </div>
                    )}

                    {stage === 'processing' && (
                        <div className="max-w-7xl mx-auto py-12 px-6">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">AI Classification in Progress</h1>
                                <p className="text-gray-600">Analyzing message and determining intent...</p>
                            </div>
                            <AIProcessing stage={processingStage} scenario={currentScenario} />
                        </div>
                    )}

                    {stage === 'json' && currentScenario && (
                        <div className="max-w-7xl mx-auto py-12 px-6">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Classification Complete</h1>
                                <p className="text-gray-600">AI has classified the ticket and determined the next action</p>
                            </div>
                            <JSONOutput 
                                classification={scenarios[currentScenario].classification} 
                                onContinue={handleContinueToSalesforce}
                            />
                        </div>
                    )}

                    {stage === 'salesforce' && (
                        <div className="min-h-screen">
                            <SalesforceHeader 
                                currentView={currentView} 
                                setCurrentView={setCurrentView}
                                newCaseId={newCaseId}
                            />
                            
                            {currentView === 'cases' && !selectedCase && (
                                <CasesListView 
                                    cases={cases} 
                                    onSelectCase={(c) => setSelectedCase(c)}
                                    newCaseId={newCaseId}
                                    createdCaseIds={createdCaseIds}
                                />
                            )}

                            {currentView === 'cases' && selectedCase && (
                                <CaseDetailView 
                                    caseData={selectedCase}
                                    scenario={currentScenario}
                                    onBack={() => setSelectedCase(null)}
                                    onViewLead={() => {
                                        const lead = leads.find(l => l.clinic === scenarios[currentScenario]?.clinicName);
                                        if (lead) {
                                            setSelectedLead(lead);
                                            setCurrentView('leads');
                                        }
                                    }}
                                />
                            )}

                            {currentView === 'leads' && !selectedLead && (
                                <LeadsListView 
                                    leads={leads}
                                    onSelectLead={(l) => setSelectedLead(l)}
                                    newLeadId={newLeadId}
                                    createdLeadIds={createdLeadIds}
                                />
                            )}

                            {currentView === 'leads' && selectedLead && (
                                <LeadDetailView 
                                    lead={selectedLead}
                                    scenario={selectedLead.clinic === scenarios[currentScenario]?.clinicName ? currentScenario : null}
                                    onBack={() => setSelectedLead(null)}
                                    onConvert={() => handleConvertLead(selectedLead)}
                                />
                            )}

                            {currentView === 'opportunities' && (
                                <OpportunitiesListView opportunities={opportunities} />
                            )}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
